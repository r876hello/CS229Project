from fastai import *
from fastai.vision import *


data = ImageList.from_folder("../TEST2").split_by_folder().label_from_folder().databunch(bs=64)
print("There are", len(data.train_ds), " training images and", len(data.valid_ds), "test images")

print(data.classes)





learner = cnn_learner(data, models.resnet18, metrics=[accuracy], pretrained=True, model_dir = "/tmp/model")


learner.load("rnet18")

preds, target, losses = learner.get_preds(data.train_ds, with_loss=True)
print(accuracy(preds, target))
interp = ClassificationInterpretation(learner, preds, target, losses)
print(interp.confusion_matrix())

#preds, target = learner.get_preds(data.valid_ds)
#print(accuracy(preds, target))
